(this["webpackJsonpdraft-app"]=this["webpackJsonpdraft-app"]||[]).push([[0],{197:function(e,t,n){},412:function(e,t,n){},413:function(e,t,n){"use strict";n.r(t);var a=n(13),i=n(5),o=n.n(i),r=n(105),s=n.n(r),c=(n(197),n(46)),d=n(47),l=n(50),h=n(49),u=n(33),p=n(182),g=n.n(p),f=n(4),v=n(422),y=n(190),b=n(183),m=n(78),w=n(184),x=n(185),C=n(186);function O(e,t){return{x:e.x+(t.x-e.x)/2,y:e.y+(t.y-e.y)/2}}var S={display:"block",position:"absolute"},j=[{name:"interface",zIndex:15},{name:"drawing",zIndex:11},{name:"temp",zIndex:12},{name:"grid",zIndex:10}],k=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).componentWillUnmount=function(){a.canvasObserver.unobserve(a.canvasContainer)},a.drawImage=function(){a.props.imgSrc&&(a.image=new Image,a.image.crossOrigin="anonymous",a.image.onload=function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.ctx,n=e.img,a=e.x,i=e.y,o=e.w,r=e.h,s=e.offsetX,c=e.offsetY;"number"!==typeof a&&(a=0),"number"!==typeof i&&(i=0),"number"!==typeof o&&(o=t.canvas.width),"number"!==typeof r&&(r=t.canvas.height),"number"!==typeof s&&(s=.5),"number"!==typeof c&&(c=.5),s<0&&(s=0),c<0&&(c=0),s>1&&(s=1),c>1&&(c=1);var d,l,h,u,p=n.width,g=n.height,f=Math.min(o/p,r/g),v=p*f,y=g*f,b=1;v<o&&(b=o/v),Math.abs(b-1)<1e-14&&y<r&&(b=r/y),(d=(p-(h=p/((v*=b)/o)))*s)<0&&(d=0),(l=(g-(u=g/((y*=b)/r)))*c)<0&&(l=0),h>p&&(h=p),u>g&&(u=g),t.drawImage(n,d,l,h,u,a,i,o,r)}({ctx:a.ctx.grid,img:a.image})},a.image.src=a.props.imgSrc)},a.undo=function(){var e=a.lines.slice(0,-1);a.clear(),a.simulateDrawingLines({lines:e,immediate:!0}),a.triggerOnChange()},a.getSaveData=function(){return JSON.stringify({lines:a.lines,width:a.props.canvasWidth,height:a.props.canvasHeight})},a.loadSaveData=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.props.immediateLoading;if("string"!==typeof e)throw new Error("saveData needs to be of type string!");var n=JSON.parse(e),i=n.lines,o=n.width,r=n.height;if(!i||"function"!==typeof i.push)throw new Error("saveData.lines needs to be an array!");if(a.clear(),o===a.props.canvasWidth&&r===a.props.canvasHeight)a.simulateDrawingLines({lines:i,immediate:t});else{var s=a.props.canvasWidth/o,c=a.props.canvasHeight/r,d=(s+c)/2;a.simulateDrawingLines({lines:i.map((function(e){return Object(u.a)(Object(u.a)({},e),{},{points:e.points.map((function(e){return{x:e.x*s,y:e.y*c}})),brushRadius:e.brushRadius*d})})),immediate:t})}},a.simulateDrawingLines=function(e){var t=e.lines,n=e.immediate,i=0,o=n?0:a.props.loadTimeOffset;t.forEach((function(e){var t=e.points,r=e.brushColor,s=e.brushRadius;if(n)return a.drawPoints({points:t,brushColor:r,brushRadius:s}),a.points=t,void a.saveLine({brushColor:r,brushRadius:s});for(var c=function(e){i+=o,window.setTimeout((function(){a.drawPoints({points:t.slice(0,e+1),brushColor:r,brushRadius:s})}),i)},d=1;d<t.length;d++)c(d);i+=o,window.setTimeout((function(){a.points=t,a.saveLine({brushColor:r,brushRadius:s})}),i)}))},a.handleDrawStart=function(e){e.preventDefault(),a.isPressing=!0;var t=a.getPointerPos(e),n=t.x,i=t.y;e.touches&&e.touches.length>0&&a.lazy.update({x:n,y:i},{both:!0}),a.handlePointerMove(n,i)},a.handleDrawMove=function(e){e.preventDefault();var t=a.getPointerPos(e),n=t.x,i=t.y;a.handlePointerMove(n,i)},a.handleDrawEnd=function(e){e.preventDefault(),a.handleDrawMove(e),a.isDrawing=!1,a.isPressing=!1,a.saveLine()},a.handleCanvasResize=function(e,t){var n,i=a.getSaveData(),o=Object(b.a)(e);try{for(o.s();!(n=o.n()).done;){var r=n.value.contentRect,s=r.width,c=r.height;a.setCanvasSize(a.canvas.interface,s,c),a.setCanvasSize(a.canvas.drawing,s,c),a.setCanvasSize(a.canvas.temp,s,c),a.setCanvasSize(a.canvas.grid,s,c),a.drawGrid(a.ctx.grid),a.drawImage(),a.loop({once:!0})}}catch(d){o.e(d)}finally{o.f()}a.loadSaveData(i,!0)},a.setCanvasSize=function(e,t,n){e.width=t,e.height=n,e.style.width=t,e.style.height=n},a.getPointerPos=function(e){var t=a.canvas.interface.getBoundingClientRect(),n=e.clientX,i=e.clientY;return e.changedTouches&&e.changedTouches.length>0&&(n=e.changedTouches[0].clientX,i=e.changedTouches[0].clientY),{x:n-t.left,y:i-t.top}},a.handlePointerMove=function(e,t){if(!a.props.disabled){a.lazy.update({x:e,y:t});var n=!a.lazy.isEnabled();(a.isPressing&&!a.isDrawing||n&&a.isPressing)&&(a.isDrawing=!0,a.points.push(a.lazy.brush.toObject())),a.isDrawing&&(a.points.push(a.lazy.brush.toObject()),a.drawPoints({points:a.points,brushColor:a.props.brushColor,brushRadius:a.props.brushRadius})),a.mouseHasMoved=!0}},a.drawPoints=function(e){var t=e.points,n=e.brushColor,i=e.brushRadius;a.ctx.temp.lineJoin="round",a.ctx.temp.lineCap="round",a.ctx.temp.strokeStyle=n,a.ctx.temp.clearRect(0,0,a.ctx.temp.canvas.width,a.ctx.temp.canvas.height),a.ctx.temp.lineWidth=2*i;var o=t[0],r=t[1];a.ctx.temp.moveTo(r.x,r.y),a.ctx.temp.beginPath();for(var s=1,c=t.length;s<c;s++){var d=O(o,r);a.ctx.temp.quadraticCurveTo(o.x,o.y,d.x,d.y),o=t[s],r=t[s+1]}a.ctx.temp.lineTo(o.x,o.y),a.ctx.temp.stroke()},a.saveLine=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.brushColor,n=e.brushRadius;if(!(a.points.length<2)){a.lines.push({points:Object(y.a)(a.points),brushColor:t||a.props.brushColor,brushRadius:n||a.props.brushRadius}),a.points.length=0;var i=a.canvas.temp.width,o=a.canvas.temp.height;a.ctx.drawing.drawImage(a.canvas.temp,0,0,i,o),a.ctx.temp.clearRect(0,0,i,o),a.triggerOnChange()}},a.triggerOnChange=function(){a.props.onChange&&a.props.onChange(Object(m.a)(a))},a.clear=function(){a.lines=[],a.valuesChanged=!0,a.ctx.drawing.clearRect(0,0,a.canvas.drawing.width,a.canvas.drawing.height),a.ctx.temp.clearRect(0,0,a.canvas.temp.width,a.canvas.temp.height)},a.loop=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.once,n=void 0!==t&&t;if(a.mouseHasMoved||a.valuesChanged){var i=a.lazy.getPointerCoordinates(),o=a.lazy.getBrushCoordinates();a.drawInterface(a.ctx.interface,i,o),a.mouseHasMoved=!1,a.valuesChanged=!1}n||window.requestAnimationFrame((function(){a.loop()}))},a.drawGrid=function(e){if(!a.props.hideGrid){console.log("drawGrid!"),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.beginPath(),e.setLineDash([5,1]),e.setLineDash([]),e.strokeStyle=a.props.gridColor,e.lineWidth=.5;for(var t=25,n=25;t<e.canvas.width;){for(n=25;n<e.canvas.height;)e.moveTo(t,n),e.arc(t,n,1,0,2*Math.PI),n+=25;t+=25}e.stroke()}},a.drawInterface=function(e,t,n){a.props.hideInterface||(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.beginPath(),e.fillStyle=a.props.brushColor,e.arc(n.x,n.y,a.props.brushRadius,0,2*Math.PI,!0),e.fill(),e.beginPath(),e.fillStyle=a.props.catenaryColor,e.arc(t.x,t.y,4,0,2*Math.PI,!0),e.fill(),a.lazy.isEnabled()&&(e.beginPath(),e.lineWidth=2,e.lineCap="round",e.setLineDash([2,4]),e.strokeStyle=a.props.catenaryColor,a.catenary.drawToCanvas(a.ctx.interface,n,t,a.chainLength),e.stroke()),e.beginPath(),e.fillStyle=a.props.catenaryColor,e.arc(n.x,n.y,2,0,2*Math.PI,!0),e.fill())},a.canvas={},a.ctx={},a.catenary=new x.Catenary,a.points=[],a.lines=[],a.mouseHasMoved=!0,a.valuesChanged=!0,a.isDrawing=!1,a.isPressing=!1,a}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.lazy=new w.LazyBrush({radius:this.props.lazyRadius*window.devicePixelRatio,enabled:!0,initialPoint:{x:window.innerWidth/2,y:window.innerHeight/2}}),this.chainLength=this.props.lazyRadius*window.devicePixelRatio,this.canvasObserver=new C.a((function(t,n){return e.handleCanvasResize(t,n)})),this.canvasObserver.observe(this.canvasContainer),this.drawImage(),this.loop(),window.setTimeout((function(){var t=window.innerWidth/2,n=window.innerHeight/2;e.lazy.update({x:t-e.chainLength/4,y:n},{both:!0}),e.lazy.update({x:t+e.chainLength/4,y:n},{both:!1}),e.mouseHasMoved=!0,e.valuesChanged=!0,e.clear(),e.props.saveData&&e.loadSaveData(e.props.saveData)}),100)}},{key:"componentDidUpdate",value:function(e){e.lazyRadius!==this.props.lazyRadius&&(this.chainLength=this.props.lazyRadius*window.devicePixelRatio,this.lazy.setRadius(this.props.lazyRadius*window.devicePixelRatio)),e.saveData!==this.props.saveData&&this.loadSaveData(this.props.saveData),JSON.stringify(e)!==JSON.stringify(this.props)&&(this.valuesChanged=!0)}},{key:"render",value:function(){var e=this;return Object(a.jsx)("div",{className:this.props.className,style:Object(u.a)({display:"block",background:this.props.backgroundColor,touchAction:"none",width:this.props.canvasWidth,height:this.props.canvasHeight},this.props.style),ref:function(t){t&&(e.canvasContainer=t)},children:j.map((function(t){var n=t.name,i=t.zIndex,o="interface"===n;return Object(a.jsx)("canvas",{ref:function(t){t&&(e.canvas[n]=t,e.ctx[n]=t.getContext("2d"))},style:Object(u.a)(Object(u.a)({},S),{},{zIndex:i}),onMouseDown:o?e.handleDrawStart:void 0,onMouseMove:o?e.handleDrawMove:void 0,onMouseUp:o?e.handleDrawEnd:void 0,onMouseOut:o?e.handleDrawEnd:void 0,onTouchStart:o?e.handleDrawStart:void 0,onTouchMove:o?e.handleDrawMove:void 0,onTouchEnd:o?e.handleDrawEnd:void 0,onTouchCancel:o?e.handleDrawEnd:void 0},n)}))})}}]),n}(i.PureComponent);k.defaultProps={onChange:null,loadTimeOffset:5,lazyRadius:12,brushRadius:10,brushColor:"#444",catenaryColor:"#0a0302",gridColor:"rgba(150,150,150,0.17)",backgroundColor:"#FFF",hideGrid:!1,canvasWidth:400,canvasHeight:400,disabled:!1,imgSrc:"",saveData:"",immediateLoading:!1,hideInterface:!1};var D=n(1),R=n(187),M=n.n(R),E=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={mode:"pen"},e.onChangeSize=function(t){var n=e.props.getEditorState(),a=n.getCurrentContent(),i=e.props.block,o=new f.SelectionState({anchorKey:i.getKey(),anchorOffset:0,focusKey:i.getKey(),focusOffset:0}),r=Object(D.Map)(),s=i.getData().get("height");s="smaller"==t?200==s?200:s-100:600==s?600:s+100,r=r.set("height",s);var c=f.Modifier.mergeBlockData(a,o,r),d=f.EditorState.push(n,c,"change-block-data");e.props.setEditorState(d)},e.onToggleMode=function(){console.log("onToggleMode");var t=e.props.getEditorState(),n=t.getCurrentContent(),a=e.props.block;e.setState({mode:"pen"==a.getData().get("mode")?"eraser":"pen"});var i=new f.SelectionState({anchorKey:a.getKey(),anchorOffset:0,focusKey:a.getKey(),focusOffset:0}),o=Object(D.Map)();o=o.set("mode","pen"==a.getData().get("mode")?"eraser":"pen");var r=f.Modifier.mergeBlockData(n,i,o),s=f.EditorState.push(t,r,"change-block-data");e.props.setEditorState(s)},e}return Object(d.a)(n,[{key:"render",value:function(){var e,t=this,n=this.props.block,i=n.getData().get("height"),o=n.getData().get("size"),r=n.getData().get("mode");return e="pen"==r?{radius:1,color:"rgba(0, 0, 0, 1)"}:{radius:20,color:"rgba(255, 255, 255, 1)"},Object(a.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[Object(a.jsx)(k,{brushRadius:e.radius,brushColor:e.color,lazyRadius:0,canvasHeight:i,canvasWidth:o,hideInterface:!0,gridColor:"#7182AD",ref:function(e){return t.canvasRef=e}}),Object(a.jsxs)("div",{style:{marginLeft:5,display:"flex",flexDirection:"column"},children:[Object(a.jsx)("button",{onClick:function(){t.onChangeSize("bigger")},style:{marginBottom:"5px"},children:"Bigger"}),Object(a.jsx)("button",{onClick:function(){t.onChangeSize("smaller")},style:{marginBottom:"5px"},children:"Smaller"}),Object(a.jsx)("button",{style:"eraser"==r?{backgroundColor:"orange",color:"white"}:{},onClick:function(){t.canvasRef&&t.canvasRef.undo()},children:"Undo"})]})]})}}]),n}(o.a.Component);var z=function(e){var t={};return{store:t,initialize:function(e){var n=e.setEditorState,a=e.getEditorState;t.setEditorState=n,t.getEditorState=a},handleBeforeInput:function(e,n){if(e.match(/[A-z-0-9_*~`]/))return"not-handled";var a=function(e){var t=e.getSelection(),n=e.getCurrentContent(),a=n.getBlockForKey(t.getStartKey()),i=a.getText();if("/sketch"==i){var o=new f.SelectionState({anchorKey:a.getKey(),anchorOffset:0,focusKey:a.getKey(),focusOffset:i.length}),r=f.Modifier.setBlockType(n,o,"atomic"),s=Object(D.Map)();s=(s=(s=s.set("height",400)).set("size",800)).set("mode","pen");var c=(r=(r=f.Modifier.mergeBlockData(r,o,s)).createEntity("CANVAS","IMMUTABLE",{content:""})).getLastCreatedEntityKey();r=f.Modifier.applyEntity(r,o,c);var d=f.EditorState.push(e,r,"change-block-type"),l=new f.ContentBlock({key:Object(f.genKey)(),type:"unstyled",text:"",characterList:Object(D.List)()}),h=(r=d.getCurrentContent()).getBlockMap().set(l.key,l);return r=r.merge({blockMap:h}),d=f.EditorState.push(d,r,"add-block"),f.EditorState.forceSelection(d,new f.SelectionState({anchorKey:l.getKey(),anchorOffset:0,focusKey:l.getKey(),focusOffset:0}))}return e}(n);return n!==a?(t.setEditorState(a),"handled"):"not-handled"},MyCanvasDraw:M()(E,t)}},P=n(188),I=n.n(P),T=n(79),L=n(423),K=n(421),A=n(189),B=Object(A.a)({basename:""}),W=new K.a,N=new L.a({config:{instrumentationKey:"2ec047c1-12ab-4e4e-86df-4c43e8af07d2",maxBatchInterval:0,extensions:[W],extensionConfig:Object(T.a)({},W.identifier,{history:B})}});N.loadAppInsights();n(412);var H=/(?:^|\s|\n|[^A-z0-9_*~`])(`)((?!\1).*?)(\1)($|\s|\n|[^A-z0-9_*~`])/g,J='{"blocks":[{"key":"5r7hh","text":"Directions","type":"header-two","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"aklih","text":"Enter /sketch to create a sketch block like one below. Try drawing on it!","type":"unordered-list-item","depth":0,"inlineStyleRanges":[{"offset":6,"length":7,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"6af9f","text":"/sketch","type":"atomic","depth":0,"inlineStyleRanges":[],"entityRanges":[{"offset":0,"length":7,"key":0}],"data":{"height":400,"size":800,"mode":"pen"}},{"key":"3u42f","text":"Markdown shortcuts (not all) are supported. Make words bold by surrounding them with ** .","type":"unordered-list-item","depth":0,"inlineStyleRanges":[{"offset":55,"length":4,"style":"BOLD"},{"offset":85,"length":2,"style":"CODE"}],"entityRanges":[],"data":{}},{"key":"4lv3f","text":"I put this together quick and dirty. There are probably bugs.","type":"unordered-list-item","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}},{"key":"1fda1","text":"","type":"unstyled","depth":0,"inlineStyleRanges":[],"entityRanges":[],"data":{}}],"entityMap":{"0":{"type":"CANVAS","mutability":"IMMUTABLE","data":{"content":""}}}}';new f.CompositeDecorator([{strategy:function(e,t,n){!function(e,t,n){var a,i,o=t.getText();for(;null!==(a=e.exec(o));)n(i=a.index,i+a[0].length)}(H,e,t)},component:function(e){return Object(a.jsx)("span",Object(u.a)(Object(u.a)({},e),{},{style:{backgroundColor:"#E1E5EE",color:"red",borderRadius:"3px",padding:"0px 2px 0px 2px"},children:e.children}))}}]);var F={CODE:{backgroundColor:"#E1E5EE",color:"red",borderRadius:"3px",padding:"0px 2px 0px 2px"}},V={marginRight:"5px",backgroundColor:"#17A398",color:"white"},U=z(),G=U.MyCanvasDraw,q=[I()(),U],X=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={editorState:f.EditorState.createWithContent(Object(f.convertFromRaw)(JSON.parse(J))),voted:null},e.onChange=function(t){e.setState({editorState:t})},e.onVote=function(t){e.setState({voted:t}),fetch("https://rootofevil.azurewebsites.net/draft-app/event",{method:"POST",headers:{"Content-type":"text/plain","Access-Control-Allow-Origin":"*"},body:JSON.stringify({name:t})})},e}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.editor.focus();var e=this.state.editorState,t=e.getCurrentContent().getLastBlock(),n=new f.SelectionState({anchorKey:t.getKey(),anchorOffset:0,focusKey:t.getKey(),focusOffset:0});this.onChange(f.EditorState.forceSelection(e,n)),fetch("https://rootofevil.azurewebsites.net/draft-app/event",{method:"POST",headers:{"Content-type":"text/plain","Access-Control-Allow-Origin":"*"},body:JSON.stringify({name:"Opened"})})}},{key:"render",value:function(){var e=this;return Object(a.jsxs)("div",{className:"App",children:[Object(a.jsx)(g.a,{customStyleMap:F,editorState:this.state.editorState,onChange:this.onChange,ref:function(t){e.editor=t},plugins:q,blockRendererFn:function(t){var n=e.state.editorState.getCurrentContent();if("atomic"===t.getType()){var a=t.getEntityAt(0);if(null!=a){var i=n.getEntity(a);if(null!=i&&"CANVAS"===i.getType())return{component:G,editable:!1}}}}}),Object(a.jsxs)("div",{style:{marginLeft:"5%"},children:[Object(a.jsx)("p",{style:{marginBottom:"10px"},children:"Thanks for taking the time to look. It would help if could tell me what you think."}),Object(a.jsxs)("div",{children:[Object(a.jsx)("button",{style:"NotInterested"!==this.state.voted?{marginRight:"5px"}:V,onClick:function(){e.onVote("NotInterested")},children:"Not interested."}),Object(a.jsx)("button",{style:"Interested"!==this.state.voted?{marginRight:"5px"}:V,onClick:function(){e.onVote("Interested")},children:"This is interesting."}),Object(a.jsx)("button",{style:"JustWhatIWanted"!==this.state.voted?{marginRight:"5px"}:V,onClick:function(){e.onVote("JustWhatIWanted")},children:"Just what I need!"}),this.state.voted&&Object(a.jsx)("p",{style:{marginTop:"5px"},children:"Thanks :)"})]})]})]})}}]),n}(i.Component),Y=Object(v.a)(W,X),_=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,424)).then((function(t){var n=t.getCLS,a=t.getFID,i=t.getFCP,o=t.getLCP,r=t.getTTFB;n(e),a(e),i(e),o(e),r(e)}))};s.a.render(Object(a.jsx)(o.a.StrictMode,{children:Object(a.jsx)(Y,{})}),document.getElementById("root")),_()}},[[413,1,2]]]);
//# sourceMappingURL=main.01ed5891.chunk.js.map